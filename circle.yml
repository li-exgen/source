machine:
  timezone:
    Asia/Tokyo
  java:
    version:
      openjdk8

dependencies:
  override:
    - echo $CIRCLE_BUILD_NUM
    - mvn -B -f src/webapp/SpringExample/pom.xml clean package findbugs:findbugs pmd:pmd -Dbuild.number=$CIRCLE_BUILD_NUM -Pdeploy -Dmaven.test.skip=true

test:
  override:
    - echo "No Test"
    - # pwd;find . | sort | sed '1d;s/^\.//;s/\/\([^/]*\)$/|--\1/;s/\/[^/|]*/|  /g'
    - ls -al src/webapp/SpringExample/target/*.jar

deployment:
  production:
    branch: master
    commands:
      - echo "production deployment"
      - cd ..
      - git clone https://github.com/li-exgen/test2.git
      - ls -al test/src/webapp/SpringExample/target/*.jar
      - cd test2
      - cp -f ../test/src/webapp/SpringExample/target/*.jar ./
      - git commit -am "deploy from CircleCI"
      - git push origin master
  staging:
    branch: develop
    commands:
      - echo "staging deployment"
      - cd ..
      - git clone https://github.com/li-exgen/test2.git
      - pwd
      - find test | sort | sed '1d;s/^\.//;s/\/\([^/]*\)$/|--\1/;s/\/[^/|]*/|  /g'
      - find test2 | sort | sed '1d;s/^\.//;s/\/\([^/]*\)$/|--\1/;s/\/[^/|]*/|  /g'
      - ls -al test/src/webapp/SpringExample/target/*.jar
      - cd test2
      - cp -f ../test/src/webapp/SpringExample/target/*.jar ./
      - git commit -am "deploy from CircleCI"
      - git push origin master

general:
  branches:
    only:
      - master
      - develop

